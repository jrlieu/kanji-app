<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KanjiDict</title>
    <link rel="manifest" href="manifest.json?v=2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        :root {
            --bg: #000; --card-bg: #000; --text: #ffffff;
            --sub-text: #aaa; --accent: #81ecec; --border: #333;
        }
        [data-theme="light"] {
            --bg: #fff; --card-bg: #ffffff; --text: #000;
            --sub-text: #666; --accent: #00b894; --border: #ddd;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: -apple-system, sans-serif;
            background-color: var(--bg); color: var(--text);
            overflow: hidden; touch-action: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* SEARCH VIEW */
        #searchView { display: flex; flex-direction: column; height: 100%; }
        #searchBar {
            width: 100%; height: 70px; padding: 0 20px; font-size: 20px;
            border: none; border-bottom: 1px solid var(--border);
            background: var(--card-bg); color: var(--text); outline: none; box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #results { flex: 1; overflow-y: auto; padding-bottom: 100px; }
        .kanji-list-item { 
            padding: 20px;  background: var(--card-bg); 
            transition: background-color 0.3s ease;
        }

        /* FLASHCARD VIEW */
        #flashcardView {
            display: none; height: 100vh; width: 100vw;
            justify-content: center; align-items: flex-start;
            background-color: var(--bg); padding-top: 15vh;
            position: relative; overflow: hidden;
        }

        #fcContainer {
            width: 100%;
            text-align: center;
            will-change: transform;
            transition: transform 0.2s ease-out;
        }

        /* RESPONSIVE KANJI SIZE */
        .fc-kanji { 
            font-weight: bold; 
            margin-bottom: 20px;
            white-space: nowrap; 
            display: block;
            width: 100%;
            /* Clamp ensures it doesn't get TOO big on desktop or TOO small on mobile */
            font-size: clamp(60px, 20vw, 140px);
        }

        .fc-bottom { 
            width: 100%; display: flex; justify-content: space-between; 
            padding: 0 30px; box-sizing: border-box; margin-top: 20px; 
        }
        .hiragana { color: var(--accent); font-size: 22px; font-weight: 500; }
        .english { color: var(--sub-text); font-size: 20px; font-style: italic; }

        /* FLOATING BUTTONS */
        .fab-container {
            position: fixed; bottom: 25px; right: 20px;
            display: flex; flex-direction: column; gap: 15px; z-index: 1000;
        }
        .fab {
            width: 55px; height: 55px; border-radius: 50%;
            background: var(--accent); color: #000;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); border: none; 
            font-size: 20px; cursor: pointer;
            transition: background-color 0.3s ease;
        }
    </style>
</head>
<body data-theme="dark">

    <div id="searchView">
        <input type="text" id="searchBar" placeholder="Search..." oninput="search()">
        <div id="results"></div>
    </div>

    <div id="flashcardView">
        <div id="fcContainer">
            <div class="fc-kanji" id="fcKanji">?</div>
            <div class="fc-bottom">
                <span class="hiragana" id="fcHiragana"></span>
                <span class="english" id="fcEnglish"></span>
            </div>
        </div>
    </div>

    <div class="fab-container">
        <button class="fab" onclick="toggleView()" id="viewBtn"><i class="fas fa-layer-group"></i></button>
        <button class="fab" onclick="toggleTheme()" id="themeBtn"><i class="fas fa-sun"></i></button>
    </div>

    <script>
        const kanjiData = [
{ k: "催促", h: "さいそく", e: "To urge / To press someone for an answer" },
{ k: "涙", h: "なみだ", e: "Tears" },
{ k: "予約", h: "よやく", e: "Reservation / Appointment" },
{ k: "壊す", h: "こわす", e: "To break something" },
{ k: "迷惑", h: "めいわく", e: "Annoyance / Trouble / Nuisance" },
{ k: "賑やか", h: "にぎやか", e: "Lively / Bustling" },
{ k: "味わう", h: "あじわう", e: "To savor / To taste" },
{ k: "憧れ", h: "あこがれ", e: "Longing / Yearning / Admiration" },
{ k: "偶然", h: "ぐうぜん", e: "By chance / Accidentally" },
{ k: "柔らかい", h: "やわらかい", e: "Soft / Tender" },
{ k: "到着", h: "とうちゃく", e: "Arrival" },
{ k: "拝見", h: "はいけん", e: "To see / To look (humble)" },
{ k: "辛い", h: "からい", e: "Spicy / Salty" },
{ k: "忘れ物", h: "わすれもの", e: "Lost article / Something forgotten" },
{ k: "渡す", h: "わたす", e: "To hand over" },
{ k: "偶に", h: "たまに", e: "Occasionally" },
{ k: "相談", h: "そうだん", e: "Consultation / Discussion" },
{ k: "煙い", h: "けむい", e: "Smoky" },
{ k: "廊下", h: "ろうか", e: "Hallway / Corridor" },
{ k: "引っ越し", h: "ひっこし", e: "Moving houses" },
{ k: "苦手", h: "にがて", e: "Poor at / Not good at / Hard to deal with" },
{ k: "真っ赤", h: "まっか", e: "Bright red / Flaming red" },
{ k: "小銭", h: "こぜに", e: "Small change / Coins" },
{ k: "触る", h: "さわる", e: "To touch" },
{ k: "仲間", h: "なかま", e: "Companion / Fellow / Friend / Partner" },
{ k: "褒める", h: "ほめる", e: "To praise / To compliment" },
{ k: "眺め", h: "ながめ", e: "View / Scenery / Prospect" },
{ k: "片付ける", h: "かたづける", e: "To tidy up / To put in order" },
{ k: "横断", h: "おうだん", e: "Crossing (e.g. pedestrian crossing)" },
{ k: "溜息", h: "ためいき", e: "A sigh" },
{ k: "御飯", h: "ごはん", e: "Rice / Meal" },
{ k: "野菜", h: "やさい", e: "Vegetable" },
{ k: "果物", h: "くだもの", e: "Fruit" },
{ k: "水", h: "みず", e: "Water" },
{ k: "お茶", h: "おちゃ", e: "Green tea" },
{ k: "牛乳", h: "ぎゅうにゅう", e: "Milk" },
{ k: "朝御飯", h: "あさごはん", e: "Breakfast" },
{ k: "昼御飯", h: "ひるごはん", e: "Lunch" },
{ k: "晩御飯", h: "ばんごはん", e: "Dinner" },
{ k: "箸", h: "はし", e: "Chopsticks" },
{ k: "皿", h: "さら", e: "Plate" },
{ k: "杯", h: "さかずき", e: "Sake cup / Glass" },
{ k: "料理", h: "りょうり", e: "Cooking / Cuisine" },
{ k: "好物", h: "こうぶつ", e: "Favorite food" },
{ k: "甘い", h: "あまい", e: "Sweet" },
{ k: "辛い", h: "からい", e: "Spicy" },
{ k: "塩", h: "しお", e: "Salt" },
{ k: "砂糖", h: "さとう", e: "Sugar" },
{ k: "美味しい", h: "おいしい", e: "Delicious" },
{ k: "不味い", h: "まずい", e: "Bad-tasting" },
{ k: "学校", h: "がっこう", e: "School" },
{ k: "教室", h: "きょうしつ", e: "Classroom" },
{ k: "先生", h: "せんせい", e: "Teacher" },
{ k: "生徒", h: "せいと", e: "Student" },
{ k: "勉強", h: "べんきょう", e: "Study" },
{ k: "宿題", h: "しゅくだい", e: "Homework" },
{ k: "試験", h: "しけん", e: "Exam" },
{ k: "質問", h: "しつもん", e: "Question" },
{ k: "答え", h: "こたえ", e: "Answer" },
{ k: "本", h: "ほん", e: "Book" },
{ k: "辞書", h: "じしょ", e: "Dictionary" },
{ k: "鉛筆", h: "えんぴつ", e: "Pencil" },
{ k: "消しゴム", h: "けしゴム", e: "Eraser" },
{ k: "紙", h: "かみ", e: "Paper" },
{ k: "鞄", h: "かばん", e: "Bag" },
{ k: "時計", h: "とけい", e: "Clock / Watch" },
{ k: "電話", h: "でんわ", e: "Telephone" },
{ k: "傘", h: "かさ", e: "Umbrella" },
{ k: "靴", h: "くつ", e: "Shoes" },
{ k: "服", h: "ふく", e: "Clothes" },
{ k: "着物", h: "きもの", e: "Kimono" },
{ k: "帽子", h: "ぼうし", e: "Hat" },
{ k: "眼鏡", h: "めがね", e: "Glasses" },
{ k: "町", h: "まち", e: "Town" },
{ k: "店", h: "みせ", e: "Shop" },
{ k: "駅", h: "えき", e: "Station" },
{ k: "病院", h: "びょういん", e: "Hospital" },
{ k: "銀行", h: "ぎんこう", e: "Bank" },
{ k: "郵便局", h: "ゆうびんきょく", e: "Post office" },
{ k: "公園", h: "こうえん", e: "Park" },
{ k: "神社", h: "じんじゃ", e: "Shinto shrine" },
{ k: "お寺", h: "おてら", e: "Buddhist temple" },
{ k: "交番", h: "こうばん", e: "Police box" },
{ k: "信号", h: "しんごう", e: "Traffic light" },
{ k: "道", h: "みち", e: "Road / Way" },
{ k: "右", h: "みぎ", e: "Right" },
{ k: "左", h: "ひだり", e: "Left" },
{ k: "前", h: "まえ", e: "Front" },
{ k: "後ろ", h: "うしろ", e: "Back / Behind" },
{ k: "中", h: "なか", e: "Inside" },
{ k: "外", h: "そと", e: "Outside" },
{ k: "上", h: "うえ", e: "Up / Above" },
{ k: "下", h: "した", e: "Down / Below" },
{ k: "今日", h: "きょう", e: "Today" },
{ k: "明日", h: "あした", e: "Tomorrow" },
{ k: "昨日", h: "きのう", e: "Yesterday" },
{ k: "毎日", h: "まいにち", e: "Every day" },
{ k: "毎朝", h: "まいあさ", e: "Every morning" },
{ k: "毎晩", h: "まいばん", e: "Every night" },
{ k: "週間", h: "しゅうかん", e: "Week" },
{ k: "月曜日", h: "げつようび", e: "Monday" },
{ k: "火曜日", h: "かようび", e: "Tuesday" },
{ k: "水曜日", h: "すいようび", e: "Wednesday" },
{ k: "木曜日", h: "もくようび", e: "Thursday" },
{ k: "金曜日", h: "きんようび", e: "Friday" },
{ k: "土曜日", h: "どようび", e: "Saturday" },
{ k: "日曜日", h: "にちようび", e: "Sunday" },
{ k: "一月", h: "いちがつ", e: "January" },
{ k: "二月", h: "にがつ", e: "February" },
{ k: "三月", h: "さんがつ", e: "March" },
{ k: "四月", h: "しがつ", e: "April" },
{ k: "五月", h: "ごがつ", e: "May" },
{ k: "六月", h: "ろくがつ", e: "June" },
{ k: "七月", h: "しちがつ", e: "July" },
{ k: "八月", h: "はちがつ", e: "August" },
{ k: "九月", h: "くがつ", e: "September" },
{ k: "十月", h: "じゅうがつ", e: "October" },
{ k: "十一月", h: "じゅういちがつ", e: "November" },
{ k: "十二月", h: "じゅうにがつ", e: "December" },
{ k: "天気", h: "てんき", e: "Weather" },
{ k: "雨", h: "あめ", e: "Rain" },
{ k: "雪", h: "ゆき", e: "Snow" },
{ k: "風", h: "かぜ", e: "Wind" },
{ k: "暑い", h: "あつい", e: "Hot (weather)" },
{ k: "寒い", h: "さむい", e: "Cold (weather)" },
{ k: "暖かい", h: "あたたかい", e: "Warm" },
{ k: "涼しい", h: "すずしい", e: "Cool" },
{ k: "静か", h: "しずか", e: "Quiet" },
{ k: "賑やか", h: "にぎやか", e: "Lively" },
{ k: "一人", h: "ひとり", e: "One person / Alone" },
{ k: "二人", h: "ふたり", e: "Two people" },
{ k: "三人", h: "さんにん", e: "Three people" },
{ k: "大人", h: "おとな", e: "Adult" },
{ k: "子供", h: "こども", e: "Child" },
{ k: "男", h: "おとこ", e: "Man" },
{ k: "女", h: "おんな", e: "Woman" },
{ k: "男の子", h: "おとこのこ", e: "Boy" },
{ k: "女の子", h: "おんなのこ", e: "Girl" },
{ k: "外国人", h: "がいこくじん", e: "Foreigner" },
{ k: "日本人", h: "にほんじん", e: "Japanese person" },
{ k: "手", h: "て", e: "Hand" },
{ k: "足", h: "あし", e: "Foot / Leg" },
{ k: "目", h: "め", e: "Eye" },
{ k: "耳", h: "みみ", e: "Ear" },
{ k: "口", h: "くち", e: "Mouth" },
{ k: "鼻", h: "はな", e: "Nose" },
{ k: "頭", h: "あたま", e: "Head" },
{ k: "顔", h: "かお", e: "Face" },
{ k: "髪", h: "かみ", e: "Hair" },
{ k: "心", h: "こころ", e: "Heart / Mind" },
{ k: "体", h: "からだ", e: "Body" },
{ k: "元気", h: "げんき", e: "Healthy / Energetic" },
{ k: "病気", h: "びょうき", e: "Sick / Illness" },
{ k: "医者", h: "いしゃ", e: "Doctor" },
{ k: "薬", h: "くすり", e: "Medicine" },
{ k: "痛い", h: "いたい", e: "Painful" },
{ k: "強い", h: "つよい", e: "Strong" },
{ k: "弱い", h: "よわい", e: "Weak" },
{ k: "高い", h: "たかい", e: "High / Expensive" },
{ k: "低い", h: "ひくい", e: "Low" },
{ k: "安い", h: "やすい", e: "Cheap" },
{ k: "新しい", h: "あたらしい", e: "New" },
{ k: "古い", h: "ふるい", e: "Old" },
{ k: "熱い", h: "あつい", e: "Hot (object)" },
{ k: "冷たい", h: "つめたい", e: "Cold (object)" },
{ k: "大きい", h: "おおきい", e: "Big" },
{ k: "小さい", h: "ちいさい", e: "Small" },
{ k: "長い", h: "ながい", e: "Long" },
{ k: "短い", h: "みじかい", e: "Short" },
{ k: "早い", h: "はやい", e: "Early / Fast" },
{ k: "遅い", h: "おそい", e: "Late / Slow" },
{ k: "多い", h: "おおい", e: "Many" },
{ k: "少ない", h: "すくない", e: "Few" },
{ k: "良い", h: "いい", e: "Good" },
{ k: "悪い", h: "わるい", e: "Bad" },
{ k: "忙しい", h: "いそがしい", e: "Busy" },
{ k: "楽しい", h: "たのしい", e: "Fun" },
{ k: "面白い", h: "おもしろい", e: "Interesting / Funny" },
{ k: "つまらない", h: "つまらない", e: "Boring" },
{ k: "怖い", h: "こわい", e: "Scary" },
{ k: "羨ましい", h: "うらやましい", e: "Jealous / Envious" },
{ k: "眠い", h: "ねむい", e: "Sleepy" },
{ k: "疲れた", h: "つかれた", e: "Tired" },
{ k: "行く", h: "いく", e: "To go" },
{ k: "来る", h: "くる", e: "To come" },
{ k: "帰る", h: "かえる", e: "To return home" },
{ k: "食べる", h: "たべる", e: "To eat" },
{ k: "飲む", h: "のむ", e: "To drink" },
{ k: "見る", h: "みる", e: "To see / To watch" },
{ k: "聞く", h: "きく", e: "To listen / To ask" },
{ k: "話す", h: "はなす", e: "To speak" },
{ k: "読む", h: "よむ", e: "To read" },
{ k: "書く", h: "かく", e: "To write" },
{ k: "買う", h: "かう", e: "To buy" },
{ k: "売る", h: "うる", e: "To sell" },
{ k: "作る", h: "つくる", e: "To make" },
{ k: "使う", h: "つかう", e: "To use" },
{ k: "待つ", h: "まつ", e: "To wait" },
{ k: "持つ", h: "もつ", e: "To hold / To have" },
{ k: "分かる", h: "わかる", e: "To understand" },
{ k: "思う", h: "おもう", e: "To think" },
{ k: "言う", h: "いう", e: "To say" },
{ k: "出かける", h: "でかける", e: "To go out" },
{ k: "入る", h: "はいる", e: "To enter" },
{ k: "出る", h: "でる", e: "To exit" },
{ k: "寝る", h: "ねる", e: "To sleep" },
{ k: "起きる", h: "おきる", e: "To wake up" },
{ k: "泳ぐ", h: "およぐ", e: "To swim" },
{ k: "遊ぶ", h: "あそぶ", e: "To play" },
{ k: "働く", h: "はたらく", e: "To work" },
{ k: "休む", h: "やすむ", e: "To rest" },
{ k: "勉強する", h: "べんきょうする", e: "To study" },
{ k: "運動する", h: "うんどうする", e: "To exercise" },
{ k: "買い物", h: "かいもの", e: "Shopping" },
{ k: "食事", h: "しょくじ", e: "Meal" },
{ k: "散歩", h: "さんぽ", e: "Walk / Stroll" },
{ k: "旅行", h: "りょこう", e: "Travel" },
{ k: "写真", h: "しゃしん", e: "Photograph" },
{ k: "映画", h: "えいが", e: "Movie" },
{ k: "音楽", h: "おんがく", e: "Music" },
{ k: "歌", h: "うた", e: "Song" },
{ k: "話", h: "はなし", e: "Story / Talk" },
{ k: "言葉", h: "ことば", e: "Word / Language" },
{ k: "意味", h: "いみ", e: "Meaning" },
{ k: "漢字", h: "かんじ", e: "Kanji" },
{ k: "日本語", h: "にほんご", e: "Japanese language" },
{ k: "英語", h: "えいご", e: "English language" },
{ k: "中国語", h: "ちゅうごくご", e: "Chinese language" },
{ k: "韓国語", h: "かんこくご", e: "Korean language" },
{ k: "少し", h: "すこし", e: "A little" },
{ k: "沢山", h: "たくさん", e: "Many / A lot" },
{ k: "初めて", h: "はじめて", e: "For the first time" },
{ k: "初め", h: "はじめ", e: "Beginning" },
{ k: "終わり", h: "おわり", e: "End" },
{ k: "半", h: "はん", e: "Half" },
{ k: "毎週", h: "まいしゅう", e: "Every week" },
{ k: "毎月", h: "まいつき", e: "Every month" },
{ k: "毎年", h: "まいとし", e: "Every year" },
{ k: "今年", h: "ことし", e: "This year" },
{ k: "去年", h: "きょねん", e: "Last year" },
{ k: "来年", h: "らいねん", e: "Next year" },
{ k: "先週", h: "せんしゅう", e: "Last week" },
{ k: "来週", h: "らいしゅう", e: "Next week" },
{ k: "今週", h: "こんしゅう", e: "This week" },
{ k: "今朝", h: "けさ", e: "This morning" },
{ k: "今夜", h: "こんや", e: "Tonight" },
{ k: "夕べ", h: "ゆうべ", e: "Last night / Evening" },
{ k: "昼", h: "ひる", e: "Noon / Afternoon" },
{ k: "夜", h: "よる", e: "Night" },
{ k: "朝", h: "あさ", e: "Morning" },
{ k: "晩", h: "ばん", e: "Evening" },
{ k: "午前", h: "ごぜん", e: "A.M. / Morning" },
{ k: "午後", h: "ごご", e: "P.M. / Afternoon" },
{ k: "分", h: "ふん", e: "Minute" },
{ k: "時間", h: "じかん", e: "Time / Hour" },
{ k: "半", h: "はん", e: "Half" },
{ k: "何時", h: "なんじ", e: "What time" },
{ k: "何曜日", h: "なんようび", e: "What day of the week" },
{ k: "誕生日", h: "たんじょうび", e: "Birthday" },
{ k: "誕生日", h: "たんじょうび", e: "Birthday" },
{ k: "年", h: "とし", e: "Year" },
{ k: "月", h: "つき", e: "Month / Moon" },
{ k: "日", h: "ひ", e: "Day / Sun" },
{ k: "曜日", h: "ようび", e: "Day of the week" },
{ k: "昨日", h: "きのう", e: "Yesterday" },
{ k: "一昨日", h: "おととい", e: "Day before yesterday" },
{ k: "明後日", h: "あさって", e: "Day after tomorrow" },
{ k: "今", h: "いま", e: "Now" },
{ k: "昔", h: "むかし", e: "Long ago" },
{ k: "未来", h: "みらい", e: "Future" },
{ k: "色", h: "いろ", e: "Color" },
{ k: "赤", h: "あか", e: "Red" },
{ k: "青", h: "あお", e: "Blue" },
{ k: "黄色", h: "きいろ", e: "Yellow" },
{ k: "黒", h: "くろ", e: "Black" },
{ k: "白", h: "しろ", e: "White" },
{ k: "茶色", h: "ちゃいろ", e: "Brown" },
{ k: "紫色", h: "むらさきいろ", e: "Purple" },
{ k: "緑", h: "みどり", e: "Green" },
{ k: "橙色", h: "だいだいいろ", e: "Orange" },
{ k: "金色", h: "きんいろ", e: "Gold" },
{ k: "銀色", h: "ぎんいろ", e: "Silver" },
{ k: "犬", h: "いぬ", e: "Dog" },
{ k: "猫", h: "ねこ", e: "Cat" },
{ k: "鳥", h: "とり", e: "Bird" },
{ k: "魚", h: "さかな", e: "Fish" },
{ k: "虫", h: "むし", e: "Insect" },
{ k: "花", h: "はな", e: "Flower" },
{ k: "草", h: "くさ", e: "Grass" },
{ k: "木", h: "き", e: "Tree / Wood" },
{ k: "森", h: "もり", e: "Forest" },
{ k: "山", h: "やま", e: "Mountain" },
{ k: "川", h: "かわ", e: "River" },
{ k: "海", h: "うみ", e: "Sea / Ocean" },
{ k: "空", h: "そら", e: "Sky" },
{ k: "星", h: "ほし", e: "Star" },
{ k: "月", h: "つき", e: "Moon" },
{ k: "太陽", h: "たいよう", e: "Sun" },
{ k: "地球", h: "ちきゅう", e: "Earth" },
{ k: "世界", h: "せかい", e: "World" },
{ k: "国", h: "くに", e: "Country" },
{ k: "日本", h: "にほん", e: "Japan" },
{ k: "アメリカ", h: "アメリカ", e: "America" },
{ k: "中国", h: "ちゅうごく", e: "China" },
{ k: "韓国", h: "かんこく", e: "Korea" },
{ k: "隣", h: "となり", e: "Next door / Neighbor" },
{ k: "近所", h: "きんじょ", e: "Neighborhood" },
{ k: "場所", h: "ばしょ", e: "Place" },
{ k: "中", h: "なか", e: "Inside" },
{ k: "外", h: "そと", e: "Outside" },
{ k: "上", h: "うえ", e: "Top / Above" },
{ k: "下", h: "した", e: "Bottom / Below" },
{ k: "右", h: "みぎ", e: "Right" },
{ k: "左", h: "ひだり", e: "Left" },
{ k: "前", h: "まえ", e: "Front / Before" },
{ k: "後ろ", h: "うしろ", e: "Back / Behind" },
{ k: "隣", h: "となり", e: "Next to" },
{ k: "間", h: "あいだ", e: "Between / Among" },
{ k: "横", h: "よこ", e: "Side / Horizontal" },
{ k: "近く", h: "ちかく", e: "Near / Close" },
{ k: "遠く", h: "とおく", e: "Far away" },
{ k: "中々", h: "なかなか", e: "Very / Quite / Not easily" },
{ k: "一番", h: "いちばん", e: "Number one / Most" },
{ k: "大好き", h: "だいすき", e: "Very likable / Love" },
{ k: "大嫌い", h: "だいきらい", e: "Hate / Detest" },
{ k: "大好き", h: "だいすき", e: "Very likable / Love" },
{ k: "大変", h: "たいへん", e: "Hard / Tough / Very" },
{ k: "大切", h: "たいせつ", e: "Important / Precious" },
{ k: "大丈夫", h: "だいじょうぶ", e: "Okay / All right" },
{ k: "沢山", h: "たくさん", e: "Many / A lot" },
{ k: "少し", h: "すこし", e: "A little" },
{ k: "幾つ", h: "いくつ", e: "How many / How old" },
        ];

        let deck = [], history = [], currentCard = null, isFlashcardMode = false;

        function search() {
            const query = document.getElementById('searchBar').value.toLowerCase();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            const filtered = query ? kanjiData.filter(item => 
                item.k.includes(query) || item.e.toLowerCase().includes(query) || item.h.includes(query)
            ) : kanjiData;

            filtered.forEach(item => {
                const card = document.createElement('div');
                card.className = 'kanji-list-item';
                card.innerHTML = `<div style="font-size:32px; font-weight:bold;">${item.k}</div>
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <span style="color:var(--accent)">${item.h}</span>
                        <span style="color:var(--sub-text)">${item.e}</span>
                    </div>`;
                resultsDiv.appendChild(card);
            });
        }

        function toggleView() {
            isFlashcardMode = !isFlashcardMode;
            document.getElementById('searchView').style.display = isFlashcardMode ? 'none' : 'flex';
            document.getElementById('flashcardView').style.display = isFlashcardMode ? 'flex' : 'none';
            document.querySelector('#viewBtn i').className = isFlashcardMode ? 'fas fa-magnifying-glass' : 'fas fa-layer-group';
            if (isFlashcardMode) { resetDeck(); showNext(); }
        }

        function resetDeck() {
            deck = [...kanjiData].sort(() => Math.random() - 0.5);
            history = []; currentCard = null;
        }

        function displayCard(card) {
            currentCard = card;
            const kanjiEl = document.getElementById('fcKanji');
            
            // DYNAMIC FONT SCALING based on string length
            const len = card.k.length;
            if (len > 5) {
                kanjiEl.style.fontSize = 'clamp(40px, 12vw, 70px)';
            } else if (len > 3) {
                kanjiEl.style.fontSize = 'clamp(50px, 15vw, 100px)';
            } else {
                kanjiEl.style.fontSize = 'clamp(60px, 20vw, 140px)';
            }

            kanjiEl.innerText = card.k;
            document.getElementById('fcHiragana').innerText = card.h;
            document.getElementById('fcEnglish').innerText = card.e;
        }

        function showNext() {
            if (deck.length === 0) resetDeck();
            if (currentCard) history.push(currentCard);
            displayCard(deck.pop());
        }

        function showPrev() {
            if (history.length > 0) {
                deck.push(currentCard);
                displayCard(history.pop());
            }
        }

        // --- SWIPE LOGIC ---
        let startX = 0;
        let currentX = 0;
        const fcView = document.getElementById('flashcardView');
        const container = document.getElementById('fcContainer');

        fcView.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            container.style.transition = 'none'; 
        });

        fcView.addEventListener('touchmove', (e) => {
            currentX = e.touches[0].clientX - startX;
            container.style.transform = `translateX(${currentX}px)`;
        });

        fcView.addEventListener('touchend', () => {
            container.style.transition = 'transform 0.2s ease-out';
            if (currentX < -80) { 
                container.style.transform = 'translateX(-100%)';
                setTimeout(() => {
                    showNext();
                    container.style.transition = 'none';
                    container.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        container.style.transition = 'transform 0.2s ease-out';
                        container.style.transform = 'translateX(0)';
                    }, 20);
                }, 200);
            } else if (currentX > 80) { 
                container.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    showPrev();
                    container.style.transition = 'none';
                    container.style.transform = 'translateX(-100%)';
                    setTimeout(() => {
                        container.style.transition = 'transform 0.2s ease-out';
                        container.style.transform = 'translateX(0)';
                    }, 20);
                }, 200);
            } else {
                container.style.transform = 'translateX(0)';
            }
            currentX = 0;
        });

        function toggleTheme() {
            const body = document.body;
            const themeBtnIcon = document.querySelector('#themeBtn i');
            const currentTheme = body.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                body.setAttribute('data-theme', 'light');
                themeBtnIcon.className = 'fas fa-circle-half-stroke';
            } else {
                body.setAttribute('data-theme', 'dark');
                themeBtnIcon.className = 'fas fa-sun';
            }
        }

        search();

        // FIXED SERVICE WORKER REGISTRATION - No more auto-refresh
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // Removed the timestamp parameter that was causing unnecessary updates
                navigator.serviceWorker.register('./sw.js').then(function(reg) {
                    console.log('SW registered successfully');
                    
                    // Silently check for updates (no page reload)
                    reg.update();
                    
                    // Optional: Just log when a new version is available without reloading
                    reg.onupdatefound = () => {
                        const installingWorker = reg.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    console.log('New version available - will be used next load');
                                    // You could show a subtle notification here if you want
                                } else {
                                    console.log('Content cached for offline use');
                                }
                            }
                        };
                    };
                }).catch(function(error) {
                    console.log('SW registration failed:', error);
                });
            });
        }
    </script>
</body>
</html>

