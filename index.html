<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KanjiDict — home + top nav</title>
    <link rel="manifest" href="manifest.json?v=2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        * { box-sizing: border-box; }
        :root {
            --bg: #000; --card-bg: #000; --text: #ffffff;
            --sub-text: #aaa; --accent: ; --border: rgba(0,0,0,0);
            --quiz-option-bg: #1a1a1a; --table-header: #222;
            --correct-bg: rgba(0, 184, 148, 0.15);
            --wrong-bg: rgba(214, 48, 49, 0.15);
            --nav-bg: #00b894;
        }
        [data-theme="light"] {
            --bg: #fff; --card-bg: #ffffff; --text: #000;
            --sub-text: #555; --accent: ; --border: rgba(0,0,0,0);
            --quiz-option-bg: #f0f0f0; --table-header: #eaeaea;
            --correct-bg: rgba(0, 184, 148, 0.1);
            --wrong-bg: rgba(214, 48, 49, 0.1);
            --nav-bg: lightgray;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg); color: var(--text);
            overflow: hidden; touch-action: none;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        /* ----- TOP NAVIGATION (home + search + 3 icons) ----- */
        .top-nav {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--nav-bg);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .home-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--accent);
            color: #000;
            border: none;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: 0.1s;
            border: 1px solid rgba(255,255,255,0.2);
            flex-shrink: 0;
        }
        .home-btn:active { transform: scale(0.92); }
        
        .search-wrapper {
            flex: 1;
            min-width: 0;
        }
        #searchBar {
            width: 100%;
            height: 44px;
            padding: 0 18px;
            font-size: 18px;
            border: 2px solid var(--border);
            border-radius: 40px;
            background: var(--card-bg);
            color: var(--text);
            outline: none;
            transition: 0.2s;
        }
        #searchBar:focus { border-color: var(--accent); }
        
        .nav-icons {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }
        .nav-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--accent);
            color: #000;
            border: none;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: 0.1s;
            border: 1px solid rgba(255,255,255,0.2);
            flex-shrink: 0;
        }
        .nav-btn:active { transform: scale(0.92); }

        /* views container */
        .view {
            display: none;
            flex-direction: column;
            height: calc(100% - 65px); /* top-nav height ~65px */
            width: 100%;
            position: absolute;
            top: 65px;
            left: 0;
        }
        .active-view { display: flex; }

        /* SEARCH VIEW results */
        #results { 
            flex: 1; 
            overflow-y: auto; 
            padding: 10px 10px 20px; 
        }
        .kanji-list-item { 
            padding: 20px; 
            background: var(--card-bg); 
            border-radius: 20px; 
            margin-bottom: 8px; 
            border: 1px solid var(--border);
        }

        /* FLASHCARD VIEW */
        #flashcardView {
            justify-content: center;
            align-items: flex-start;
            background-color: var(--bg);
            padding-top: 8vh;
            overflow: hidden;
        }
        #fcContainer {
            width: 100%;
            text-align: center;
            will-change: transform;
            transition: transform 0.2s ease-out;
        }
        .fc-kanji { 
            font-weight: bold; 
            margin-bottom: 20px; 
            white-space: nowrap; 
            display: block; 
            width: 100%;
            font-size: clamp(60px, 20vw, 140px);
        }
        .fc-bottom { 
            width: 100%; 
            display: flex; 
            justify-content: space-between; 
            padding: 0 30px; 
            box-sizing: border-box; 
            margin-top: 20px; 
        }
        .hiragana { color: var(--accent); font-size: 22px; font-weight: 500; }
        .english { color: var(--sub-text); font-size: 20px; font-style: italic; }

        /* QUIZ VIEW */
        #quizView {
            background: var(--bg);
            overflow-y: auto;
            padding: 16px 16px 30px;
        }
        .quiz-header {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 20px; 
            font-size: 18px;
            background: var(--card-bg); 
            padding: 14px 20px; 
            border-radius: 40px;
            border: 1px solid gray;
        }
        .quiz-progress { color: var(--accent); font-weight: 700; }
        .quiz-card {
            background: var(--card-bg); 
            border-radius: 36px; 
            padding: 30px 16px;
            border: 1px solid gray;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }
        .quiz-question-kanji {
            font-size: clamp(70px, 22vw, 150px); 
            font-weight: 800;
            text-align: center; 
            margin: 10px 0 30px; 
            line-height: 1.2;
            letter-spacing: 4px; 
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .quiz-options {
            display: flex; 
            flex-direction: column; 
            gap: 14px; 
            padding: 0 8px;
        }
        .quiz-option {
            background: var(--quiz-option-bg); 
            border: 2px solid var(--border);
            border-radius: 60px; 
            padding: 18px 16px; 
            font-size: 22px;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 12px;
            transition: 0.15s; 
            cursor: pointer; 
            flex-wrap: wrap;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .quiz-option.selected {
            border-color: var(--accent); 
            background: rgba(129, 236, 236, 0.2);
            transform: scale(1.01);
        }
        .quiz-option.correct-disabled {
            border-color: #00b894; 
            background: var(--correct-bg); 
            pointer-events: none;
            opacity: 0.9;
        }
        .quiz-option.wrong-disabled {
            border-color: #d63031; 
            background: var(--wrong-bg); 
            pointer-events: none;
            opacity: 0.7;
        }
        .option-hiragana {
            font-weight: 800; 
            font-size: 26px; 
            color: var(--accent);
        }
        .option-english {
            font-size: 18px; 
            color: var(--sub-text); 
            font-style: italic; 
            background: rgba(128,128,128,0.1); 
            padding: 4px 12px; 
            border-radius: 40px;
        }
        .quiz-footer {
            display: flex; 
            justify-content: space-between; 
            margin-top: 30px;
            gap: 12px; 
            padding: 0 8px;
        }
        .quiz-btn {
            background: #f0f0f0; 
            color: black; 
            border: none;
            padding: 16px 24px; 
            border-radius: 50px; 
            font-size: 18px; 
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); 
            cursor: pointer; 
            flex: 1;
            transition: opacity 0.2s; 
            text-align: center;
        }
        .quiz-btn:disabled { opacity: 0.25; pointer-events: none; }

        /* result table */
        #quizResultArea { padding: 8px 4px 20px; }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            background: var(--card-bg);
            border-radius: 28px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            border: 1px solid var(--border);
            font-size: 16px;
        }
        .result-table th {
            background: var(--table-header);
            padding: 18px 8px;
            font-weight: 700;
            font-size: 1.1rem;
            text-align: center;
            color: var(--text);
            border-bottom: 2px solid var(--accent);
        }
        .result-table td {
            padding: 16px 8px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        .result-table .correct-row { background: var(--correct-bg); }
        .result-table .wrong-row { background: var(--wrong-bg); }
        .result-table tr:last-child td { border-bottom: none; }
        @media (max-width: 400px) {
            .result-table th, .result-table td { padding: 12px 4px; font-size: 14px; }
        }
        .restart-quiz {
            background: var(--accent); color: black; border: none;
            padding: 18px; border-radius: 60px; font-size: 20px; font-weight: bold;
            margin: 20px 0 30px; cursor: pointer; width: 100%;
            box-shadow: 0 8px 16px rgba(0,0,0,0.5);
        }

        /* no floating FABs */
        .fab-container { display: none; }
    </style>
</head>
<body data-theme="dark">

    <!-- TOP NAVIGATION: home + search + 3 icon buttons -->
    <div class="top-nav">
        <button class="home-btn" id="homeBtn" onclick="goHome()" title="Home"><i class="fas fa-home"></i></button>
        <div class="search-wrapper">
            <input type="text" id="searchBar" placeholder="Search..." oninput="search()">
        </div>
        <div class="nav-icons">
            <button class="nav-btn" id="quizNavBtn" onclick="startQuiz()" title="Quiz"><i class="fas fa-pencil-alt"></i></button>
            <button class="nav-btn" id="flashcardNavBtn" onclick="toggleFlashcard()" title="Flashcards"><i class="fas fa-layer-group"></i></button>
            <button class="nav-btn" id="themeNavBtn" onclick="toggleTheme()" title="Light/Dark"><i class="fas fa-sun"></i></button>
        </div>
    </div>

    <!-- SEARCH VIEW (default active) -->
    <div id="searchView" class="view active-view">
        <div id="results"></div>
    </div>

    <!-- FLASHCARD VIEW -->
    <div id="flashcardView" class="view">
        <div id="fcContainer">
            <div class="fc-kanji" id="fcKanji">?</div>
            <div class="fc-bottom">
                <span class="hiragana" id="fcHiragana"></span>
                <span class="english" id="fcEnglish"></span>
            </div>
        </div>
    </div>

    <!-- QUIZ VIEW -->
    <div id="quizView" class="view">
        <div class="quiz-header">
            <span class="quiz-progress" id="quizProgress">Q1/20</span>
            <span id="quizScoreDisplay">0 / 20</span>
        </div>
        <div id="quizContainer"></div>
        <div id="quizResultArea" style="display: none;"></div>
    </div>

    <script>
        const kanjiData = [
{ k: "催促", h: "さいそく", e: "To urge / To press someone for an answer" },
{ k: "涙", h: "なみだ", e: "Tears" },
{ k: "予約", h: "よやく", e: "Reservation / Appointment" },
{ k: "壊す", h: "こわす", e: "To break something" },
{ k: "迷惑", h: "めいわく", e: "Annoyance / Trouble / Nuisance" },
{ k: "賑やか", h: "にぎやか", e: "Lively / Bustling" },
{ k: "味わう", h: "あじわう", e: "To savor / To taste" },
{ k: "憧れ", h: "あこがれ", e: "Longing / Yearning / Admiration" },
{ k: "偶然", h: "ぐうぜん", e: "By chance / Accidentally" },
{ k: "柔らかい", h: "やわらかい", e: "Soft / Tender" },
{ k: "到着", h: "とうちゃく", e: "Arrival" },
{ k: "拝見", h: "はいけん", e: "To see / To look (humble)" },
{ k: "辛い", h: "からい", e: "Spicy / Salty" },
{ k: "忘れ物", h: "わすれもの", e: "Lost article / Something forgotten" },
{ k: "渡す", h: "わたす", e: "To hand over" },
{ k: "偶に", h: "たまに", e: "Occasionally" },
{ k: "相談", h: "そうだん", e: "Consultation / Discussion" },
{ k: "煙い", h: "けむい", e: "Smoky" },
{ k: "廊下", h: "ろうか", e: "Hallway / Corridor" },
{ k: "引っ越し", h: "ひっこし", e: "Moving houses" },
{ k: "苦手", h: "にがて", e: "Poor at / Not good at / Hard to deal with" },
{ k: "真っ赤", h: "まっか", e: "Bright red / Flaming red" },
{ k: "小銭", h: "こぜに", e: "Small change / Coins" },
{ k: "触る", h: "さわる", e: "To touch" },
{ k: "仲間", h: "なかま", e: "Companion / Fellow / Friend / Partner" },
{ k: "褒める", h: "ほめる", e: "To praise / To compliment" },
{ k: "眺め", h: "ながめ", e: "View / Scenery / Prospect" },
{ k: "片付ける", h: "かたづける", e: "To tidy up / To put in order" },
{ k: "横断", h: "おうだん", e: "Crossing (e.g. pedestrian crossing)" },
{ k: "溜息", h: "ためいき", e: "A sigh" },
{ k: "御飯", h: "ごはん", e: "Rice / Meal" },
{ k: "野菜", h: "やさい", e: "Vegetable" },
{ k: "果物", h: "くだもの", e: "Fruit" },
{ k: "水", h: "みず", e: "Water" },
{ k: "お茶", h: "おちゃ", e: "Green tea" },
{ k: "牛乳", h: "ぎゅうにゅう", e: "Milk" },
{ k: "朝御飯", h: "あさごはん", e: "Breakfast" },
{ k: "昼御飯", h: "ひるごはん", e: "Lunch" },
{ k: "晩御飯", h: "ばんごはん", e: "Dinner" },
{ k: "箸", h: "はし", e: "Chopsticks" },
{ k: "皿", h: "さら", e: "Plate" },
{ k: "杯", h: "さかずき", e: "Sake cup / Glass" },
{ k: "料理", h: "りょうり", e: "Cooking / Cuisine" },
{ k: "好物", h: "こうぶつ", e: "Favorite food" },
{ k: "甘い", h: "あまい", e: "Sweet" },
{ k: "辛い", h: "からい", e: "Spicy" },
{ k: "塩", h: "しお", e: "Salt" },
{ k: "砂糖", h: "さとう", e: "Sugar" },
{ k: "美味しい", h: "おいしい", e: "Delicious" },
{ k: "不味い", h: "まずい", e: "Bad-tasting" },
{ k: "学校", h: "がっこう", e: "School" },
{ k: "教室", h: "きょうしつ", e: "Classroom" },
{ k: "先生", h: "せんせい", e: "Teacher" },
{ k: "生徒", h: "せいと", e: "Student" },
{ k: "勉強", h: "べんきょう", e: "Study" },
{ k: "宿題", h: "しゅくだい", e: "Homework" },
{ k: "試験", h: "しけん", e: "Exam" },
{ k: "質問", h: "しつもん", e: "Question" },
{ k: "答え", h: "こたえ", e: "Answer" },
{ k: "本", h: "ほん", e: "Book" },
{ k: "辞書", h: "じしょ", e: "Dictionary" },
{ k: "鉛筆", h: "えんぴつ", e: "Pencil" },
{ k: "消しゴム", h: "けしゴム", e: "Eraser" },
{ k: "紙", h: "かみ", e: "Paper" },
{ k: "鞄", h: "かばん", e: "Bag" },
{ k: "時計", h: "とけい", e: "Clock / Watch" },
{ k: "電話", h: "でんわ", e: "Telephone" },
{ k: "傘", h: "かさ", e: "Umbrella" },
{ k: "靴", h: "くつ", e: "Shoes" },
{ k: "服", h: "ふく", e: "Clothes" },
{ k: "着物", h: "きもの", e: "Kimono" },
{ k: "帽子", h: "ぼうし", e: "Hat" },
{ k: "眼鏡", h: "めがね", e: "Glasses" },
{ k: "町", h: "まち", e: "Town" },
{ k: "店", h: "みせ", e: "Shop" },
{ k: "駅", h: "えき", e: "Station" },
{ k: "病院", h: "びょういん", e: "Hospital" },
{ k: "銀行", h: "ぎんこう", e: "Bank" },
{ k: "郵便局", h: "ゆうびんきょく", e: "Post office" },
{ k: "公園", h: "こうえん", e: "Park" },
{ k: "神社", h: "じんじゃ", e: "Shinto shrine" },
{ k: "お寺", h: "おてら", e: "Buddhist temple" },
{ k: "交番", h: "こうばん", e: "Police box" },
{ k: "信号", h: "しんごう", e: "Traffic light" },
{ k: "道", h: "みち", e: "Road / Way" },
{ k: "右", h: "みぎ", e: "Right" },
{ k: "左", h: "ひだり", e: "Left" },
{ k: "前", h: "まえ", e: "Front" },
{ k: "後ろ", h: "うしろ", e: "Back / Behind" },
{ k: "中", h: "なか", e: "Inside" },
{ k: "外", h: "そと", e: "Outside" },
{ k: "上", h: "うえ", e: "Up / Above" },
{ k: "下", h: "した", e: "Down / Below" },
{ k: "今日", h: "きょう", e: "Today" },
{ k: "明日", h: "あした", e: "Tomorrow" },
{ k: "昨日", h: "きのう", e: "Yesterday" },
{ k: "毎日", h: "まいにち", e: "Every day" },
{ k: "毎朝", h: "まいあさ", e: "Every morning" },
{ k: "毎晩", h: "まいばん", e: "Every night" },
{ k: "週間", h: "しゅうかん", e: "Week" },
{ k: "月曜日", h: "げつようび", e: "Monday" },
{ k: "火曜日", h: "かようび", e: "Tuesday" },
{ k: "水曜日", h: "すいようび", e: "Wednesday" },
{ k: "木曜日", h: "もくようび", e: "Thursday" },
{ k: "金曜日", h: "きんようび", e: "Friday" },
{ k: "土曜日", h: "どようび", e: "Saturday" },
{ k: "日曜日", h: "にちようび", e: "Sunday" },
{ k: "一月", h: "いちがつ", e: "January" },
{ k: "二月", h: "にがつ", e: "February" },
{ k: "三月", h: "さんがつ", e: "March" },
{ k: "四月", h: "しがつ", e: "April" },
{ k: "五月", h: "ごがつ", e: "May" },
{ k: "六月", h: "ろくがつ", e: "June" },
{ k: "七月", h: "しちがつ", e: "July" },
{ k: "八月", h: "はちがつ", e: "August" },
{ k: "九月", h: "くがつ", e: "September" },
{ k: "十月", h: "じゅうがつ", e: "October" },
{ k: "十一月", h: "じゅういちがつ", e: "November" },
{ k: "十二月", h: "じゅうにがつ", e: "December" },
{ k: "天気", h: "てんき", e: "Weather" },
{ k: "雨", h: "あめ", e: "Rain" },
{ k: "雪", h: "ゆき", e: "Snow" },
{ k: "風", h: "かぜ", e: "Wind" },
{ k: "暑い", h: "あつい", e: "Hot (weather)" },
{ k: "寒い", h: "さむい", e: "Cold (weather)" },
{ k: "暖かい", h: "あたたかい", e: "Warm" },
{ k: "涼しい", h: "すずしい", e: "Cool" },
{ k: "静か", h: "しずか", e: "Quiet" },
{ k: "賑やか", h: "にぎやか", e: "Lively" },
{ k: "一人", h: "ひとり", e: "One person / Alone" },
{ k: "二人", h: "ふたり", e: "Two people" },
{ k: "三人", h: "さんにん", e: "Three people" },
{ k: "大人", h: "おとな", e: "Adult" },
{ k: "子供", h: "こども", e: "Child" },
{ k: "男", h: "おとこ", e: "Man" },
{ k: "女", h: "おんな", e: "Woman" },
{ k: "男の子", h: "おとこのこ", e: "Boy" },
{ k: "女の子", h: "おんなのこ", e: "Girl" },
{ k: "外国人", h: "がいこくじん", e: "Foreigner" },
{ k: "日本人", h: "にほんじん", e: "Japanese person" },
{ k: "手", h: "て", e: "Hand" },
{ k: "足", h: "あし", e: "Foot / Leg" },
{ k: "目", h: "め", e: "Eye" },
{ k: "耳", h: "みみ", e: "Ear" },
{ k: "口", h: "くち", e: "Mouth" },
{ k: "鼻", h: "はな", e: "Nose" },
{ k: "頭", h: "あたま", e: "Head" },
{ k: "顔", h: "かお", e: "Face" },
{ k: "髪", h: "かみ", e: "Hair" },
{ k: "心", h: "こころ", e: "Heart / Mind" },
{ k: "体", h: "からだ", e: "Body" },
{ k: "元気", h: "げんき", e: "Healthy / Energetic" },
{ k: "病気", h: "びょうき", e: "Sick / Illness" },
{ k: "医者", h: "いしゃ", e: "Doctor" },
{ k: "薬", h: "くすり", e: "Medicine" },
{ k: "痛い", h: "いたい", e: "Painful" },
{ k: "強い", h: "つよい", e: "Strong" },
{ k: "弱い", h: "よわい", e: "Weak" },
{ k: "高い", h: "たかい", e: "High / Expensive" },
{ k: "低い", h: "ひくい", e: "Low" },
{ k: "安い", h: "やすい", e: "Cheap" },
{ k: "新しい", h: "あたらしい", e: "New" },
{ k: "古い", h: "ふるい", e: "Old" },
{ k: "熱い", h: "あつい", e: "Hot (object)" },
{ k: "冷たい", h: "つめたい", e: "Cold (object)" },
{ k: "大きい", h: "おおきい", e: "Big" },
{ k: "小さい", h: "ちいさい", e: "Small" },
{ k: "長い", h: "ながい", e: "Long" },
{ k: "短い", h: "みじかい", e: "Short" },
{ k: "早い", h: "はやい", e: "Early / Fast" },
{ k: "遅い", h: "おそい", e: "Late / Slow" },
{ k: "多い", h: "おおい", e: "Many" },
{ k: "少ない", h: "すくない", e: "Few" },
{ k: "良い", h: "いい", e: "Good" },
{ k: "悪い", h: "わるい", e: "Bad" },
{ k: "忙しい", h: "いそがしい", e: "Busy" },
{ k: "楽しい", h: "たのしい", e: "Fun" },
{ k: "面白い", h: "おもしろい", e: "Interesting / Funny" },
{ k: "つまらない", h: "つまらない", e: "Boring" },
{ k: "怖い", h: "こわい", e: "Scary" },
{ k: "羨ましい", h: "うらやましい", e: "Jealous / Envious" },
{ k: "眠い", h: "ねむい", e: "Sleepy" },
{ k: "疲れた", h: "つかれた", e: "Tired" },
{ k: "行く", h: "いく", e: "To go" },
{ k: "来る", h: "くる", e: "To come" },
{ k: "帰る", h: "かえる", e: "To return home" },
{ k: "食べる", h: "たべる", e: "To eat" },
{ k: "飲む", h: "のむ", e: "To drink" },
{ k: "見る", h: "みる", e: "To see / To watch" },
{ k: "聞く", h: "きく", e: "To listen / To ask" },
{ k: "話す", h: "はなす", e: "To speak" },
{ k: "読む", h: "よむ", e: "To read" },
{ k: "書く", h: "かく", e: "To write" },
{ k: "買う", h: "かう", e: "To buy" },
{ k: "売る", h: "うる", e: "To sell" },
{ k: "作る", h: "つくる", e: "To make" },
{ k: "使う", h: "つかう", e: "To use" },
{ k: "待つ", h: "まつ", e: "To wait" },
{ k: "持つ", h: "もつ", e: "To hold / To have" },
{ k: "分かる", h: "わかる", e: "To understand" },
{ k: "思う", h: "おもう", e: "To think" },
{ k: "言う", h: "いう", e: "To say" },
{ k: "出かける", h: "でかける", e: "To go out" },
{ k: "入る", h: "はいる", e: "To enter" },
{ k: "出る", h: "でる", e: "To exit" },
{ k: "寝る", h: "ねる", e: "To sleep" },
{ k: "起きる", h: "おきる", e: "To wake up" },
{ k: "泳ぐ", h: "およぐ", e: "To swim" },
{ k: "遊ぶ", h: "あそぶ", e: "To play" },
{ k: "働く", h: "はたらく", e: "To work" },
{ k: "休む", h: "やすむ", e: "To rest" },
{ k: "勉強する", h: "べんきょうする", e: "To study" },
{ k: "運動する", h: "うんどうする", e: "To exercise" },
{ k: "買い物", h: "かいもの", e: "Shopping" },
{ k: "食事", h: "しょくじ", e: "Meal" },
{ k: "散歩", h: "さんぽ", e: "Walk / Stroll" },
{ k: "旅行", h: "りょこう", e: "Travel" },
{ k: "写真", h: "しゃしん", e: "Photograph" },
{ k: "映画", h: "えいが", e: "Movie" },
{ k: "音楽", h: "おんがく", e: "Music" },
{ k: "歌", h: "うた", e: "Song" },
{ k: "話", h: "はなし", e: "Story / Talk" },
{ k: "言葉", h: "ことば", e: "Word / Language" },
{ k: "意味", h: "いみ", e: "Meaning" },
{ k: "漢字", h: "かんじ", e: "Kanji" },
{ k: "日本語", h: "にほんご", e: "Japanese language" },
{ k: "英語", h: "えいご", e: "English language" },
{ k: "中国語", h: "ちゅうごくご", e: "Chinese language" },
{ k: "韓国語", h: "かんこくご", e: "Korean language" },
{ k: "少し", h: "すこし", e: "A little" },
{ k: "沢山", h: "たくさん", e: "Many / A lot" },
{ k: "初めて", h: "はじめて", e: "For the first time" },
{ k: "初め", h: "はじめ", e: "Beginning" },
{ k: "終わり", h: "おわり", e: "End" },
{ k: "半", h: "はん", e: "Half" },
{ k: "毎週", h: "まいしゅう", e: "Every week" },
{ k: "毎月", h: "まいつき", e: "Every month" },
{ k: "毎年", h: "まいとし", e: "Every year" },
{ k: "今年", h: "ことし", e: "This year" },
{ k: "去年", h: "きょねん", e: "Last year" },
{ k: "来年", h: "らいねん", e: "Next year" },
{ k: "先週", h: "せんしゅう", e: "Last week" },
{ k: "来週", h: "らいしゅう", e: "Next week" },
{ k: "今週", h: "こんしゅう", e: "This week" },
{ k: "今朝", h: "けさ", e: "This morning" },
{ k: "今夜", h: "こんや", e: "Tonight" },
{ k: "夕べ", h: "ゆうべ", e: "Last night / Evening" },
{ k: "昼", h: "ひる", e: "Noon / Afternoon" },
{ k: "夜", h: "よる", e: "Night" },
{ k: "朝", h: "あさ", e: "Morning" },
{ k: "晩", h: "ばん", e: "Evening" },
{ k: "午前", h: "ごぜん", e: "A.M. / Morning" },
{ k: "午後", h: "ごご", e: "P.M. / Afternoon" },
{ k: "分", h: "ふん", e: "Minute" },
{ k: "時間", h: "じかん", e: "Time / Hour" },
{ k: "半", h: "はん", e: "Half" },
{ k: "何時", h: "なんじ", e: "What time" },
{ k: "何曜日", h: "なんようび", e: "What day of the week" },
{ k: "誕生日", h: "たんじょうび", e: "Birthday" },
{ k: "誕生日", h: "たんじょうび", e: "Birthday" },
{ k: "年", h: "とし", e: "Year" },
{ k: "月", h: "つき", e: "Month / Moon" },
{ k: "日", h: "ひ", e: "Day / Sun" },
{ k: "曜日", h: "ようび", e: "Day of the week" },
{ k: "昨日", h: "きのう", e: "Yesterday" },
{ k: "一昨日", h: "おととい", e: "Day before yesterday" },
{ k: "明後日", h: "あさって", e: "Day after tomorrow" },
{ k: "今", h: "いま", e: "Now" },
{ k: "昔", h: "むかし", e: "Long ago" },
{ k: "未来", h: "みらい", e: "Future" },
{ k: "色", h: "いろ", e: "Color" },
{ k: "赤", h: "あか", e: "Red" },
{ k: "青", h: "あお", e: "Blue" },
{ k: "黄色", h: "きいろ", e: "Yellow" },
{ k: "黒", h: "くろ", e: "Black" },
{ k: "白", h: "しろ", e: "White" },
{ k: "茶色", h: "ちゃいろ", e: "Brown" },
{ k: "紫色", h: "むらさきいろ", e: "Purple" },
{ k: "緑", h: "みどり", e: "Green" },
{ k: "橙色", h: "だいだいいろ", e: "Orange" },
{ k: "金色", h: "きんいろ", e: "Gold" },
{ k: "銀色", h: "ぎんいろ", e: "Silver" },
{ k: "犬", h: "いぬ", e: "Dog" },
{ k: "猫", h: "ねこ", e: "Cat" },
{ k: "鳥", h: "とり", e: "Bird" },
{ k: "魚", h: "さかな", e: "Fish" },
{ k: "虫", h: "むし", e: "Insect" },
{ k: "花", h: "はな", e: "Flower" },
{ k: "草", h: "くさ", e: "Grass" },
{ k: "木", h: "き", e: "Tree / Wood" },
{ k: "森", h: "もり", e: "Forest" },
{ k: "山", h: "やま", e: "Mountain" },
{ k: "川", h: "かわ", e: "River" },
{ k: "海", h: "うみ", e: "Sea / Ocean" },
{ k: "空", h: "そら", e: "Sky" },
{ k: "星", h: "ほし", e: "Star" },
{ k: "月", h: "つき", e: "Moon" },
{ k: "太陽", h: "たいよう", e: "Sun" },
{ k: "地球", h: "ちきゅう", e: "Earth" },
{ k: "世界", h: "せかい", e: "World" },
{ k: "国", h: "くに", e: "Country" },
{ k: "日本", h: "にほん", e: "Japan" },
{ k: "アメリカ", h: "アメリカ", e: "America" },
{ k: "中国", h: "ちゅうごく", e: "China" },
{ k: "韓国", h: "かんこく", e: "Korea" },
{ k: "隣", h: "となり", e: "Next door / Neighbor" },
{ k: "近所", h: "きんじょ", e: "Neighborhood" },
{ k: "場所", h: "ばしょ", e: "Place" },
{ k: "中", h: "なか", e: "Inside" },
{ k: "外", h: "そと", e: "Outside" },
{ k: "上", h: "うえ", e: "Top / Above" },
{ k: "下", h: "した", e: "Bottom / Below" },
{ k: "右", h: "みぎ", e: "Right" },
{ k: "左", h: "ひだり", e: "Left" },
{ k: "前", h: "まえ", e: "Front / Before" },
{ k: "後ろ", h: "うしろ", e: "Back / Behind" },
{ k: "隣", h: "となり", e: "Next to" },
{ k: "間", h: "あいだ", e: "Between / Among" },
{ k: "横", h: "よこ", e: "Side / Horizontal" },
{ k: "近く", h: "ちかく", e: "Near / Close" },
{ k: "遠く", h: "とおく", e: "Far away" },
{ k: "中々", h: "なかなか", e: "Very / Quite / Not easily" },
{ k: "一番", h: "いちばん", e: "Number one / Most" },
{ k: "大好き", h: "だいすき", e: "Very likable / Love" },
{ k: "大嫌い", h: "だいきらい", e: "Hate / Detest" },
{ k: "大好き", h: "だいすき", e: "Very likable / Love" },
{ k: "大変", h: "たいへん", e: "Hard / Tough / Very" },
{ k: "大切", h: "たいせつ", e: "Important / Precious" },
{ k: "大丈夫", h: "だいじょうぶ", e: "Okay / All right" },
{ k: "沢山", h: "たくさん", e: "Many / A lot" },
{ k: "少し", h: "すこし", e: "A little" },
{ k: "幾つ", h: "いくつ", e: "How many / How old" },
{ k: "危ない", h: "あぶない", e: "Dangerous" },
{ k: "危険", h: "きけん", e: "Danger" },
{ k: "注意", h: "ちゅうい", e: "Caution / Warning" },
{ k: "止まれ", h: "とまれ", e: "Stop (sign)" },
{ k: "押す", h: "おす", e: "To push" },
{ k: "引く", h: "ひく", e: "To pull" },
{ k: "非常口", h: "ひじょうぐち", e: "Emergency exit" },
{ k: "入口", h: "いりぐち", e: "Entrance" },
{ k: "出口", h: "でぐち", e: "Exit" },
{ k: "階段", h: "かいだん", e: "Stairs" },
{ k: "エスカレーター", h: "エスカレーター", e: "Escalator" },
{ k: "エレベーター", h: "エレベーター", e: "Elevator" },
{ k: "お手洗い", h: "おてあらい", e: "Restroom" },
{ k: "化粧室", h: "けしょうしつ", e: "Powder room / Restroom" },
{ k: "男子", h: "だんし", e: "Men / Boys" },
{ k: "女子", h: "じょし", e: "Women / Girls" },
{ k: "使用中", h: "しようちゅう", e: "In use / Occupied" },
{ k: "空", h: "あき", e: "Vacant / Empty" },
{ k: "故障中", h: "こしょうちゅう", e: "Out of order" },
{ k: "準備中", h: "じゅんびちゅう", e: "Preparing / Not open yet" },
{ k: "営業中", h: "えいぎょうちゅう", e: "Open for business" },
{ k: "休業", h: "きゅうぎょう", e: "Closed / Business suspended" },
{ k: "定休日", h: "ていきゅうび", e: "Regular holiday" },
{ k: "満員", h: "まんいん", e: "Full / No vacancy" },
{ k: "禁煙", h: "きんえん", e: "No smoking" },
{ k: "喫煙", h: "きつえん", e: "Smoking allowed" },
{ k: "立入禁止", h: "たちいりきんし", e: "No entry" },
{ k: "駐車禁止", h: "ちゅうしゃきんし", e: "No parking" },
{ k: "駐車場", h: "ちゅうしゃじょう", e: "Parking lot" },
{ k: "一方通行", h: "いっぽうつうこう", e: "One way street" },
{ k: "横断歩道", h: "おうだんほどう", e: "Pedestrian crossing" },
{ k: "交差点", h: "こうさてん", e: "Intersection" },
{ k: "曲がる", h: "まがる", e: "To turn" },
{ k: "直進", h: "ちょくしん", e: "Go straight" },
{ k: "止まる", h: "とまる", e: "To stop" },
{ k: "渡る", h: "わたる", e: "To cross" },
{ k: "運転", h: "うんてん", e: "Driving" },
{ k: "運転手", h: "うんてんしゅ", e: "Driver" },
{ k: "乗り場", h: "のりば", e: "Boarding place (bus/taxi)" },
{ k: "改札口", h: "かいさつぐち", e: "Ticket gate" },
{ k: "切符", h: "きっぷ", e: "Ticket" },
{ k: "片道", h: "かたみち", e: "One way" },
{ k: "往復", h: "おうふく", e: "Round trip" },
{ k: "料金", h: "りょうきん", e: "Fee / Fare" },
{ k: "運賃", h: "うんちん", e: "Transportation fare" },
{ k: "時刻表", h: "じこくひょう", e: "Timetable" },
{ k: "遅れる", h: "おくれる", e: "To be late" },
{ k: "間に合う", h: "まにあう", e: "To be in time" },
{ k: "乗り換え", h: "のりかえ", e: "Transfer" },
{ k: "荷物", h: "にもつ", e: "Luggage" },
{ k: "手荷物", h: "てにもつ", e: "Hand luggage" },
{ k: "預ける", h: "あずける", e: "To deposit / To check in" },
{ k: "空港", h: "くうこう", e: "Airport" },
{ k: "飛行機", h: "ひこうき", e: "Airplane" },
{ k: "電車", h: "でんしゃ", e: "Train" },
{ k: "新幹線", h: "しんかんせん", e: "Bullet train" },
{ k: "地下鉄", h: "ちかてつ", e: "Subway" },
{ k: "バス停", h: "バスてい", e: "Bus stop" },
{ k: "タクシー", h: "タクシー", e: "Taxi" },
{ k: "自転車", h: "じてんしゃ", e: "Bicycle" },
{ k: "歩く", h: "あるく", e: "To walk" },
{ k: "走る", h: "はしる", e: "To run" },
{ k: "速い", h: "はやい", e: "Fast" },
{ k: "遅い", h: "おそい", e: "Slow / Late" },
{ k: "近い", h: "ちかい", e: "Near" },
{ k: "遠い", h: "とおい", e: "Far" },
{ k: "地図", h: "ちず", e: "Map" },
{ k: "住所", h: "じゅうしょ", e: "Address" },
{ k: "電話番号", h: "でんわばんごう", e: "Phone number" },
{ k: "郵便番号", h: "ゆうびんばんごう", e: "Postal code" },
{ k: "手紙", h: "てがみ", e: "Letter" },
{ k: "はがき", h: "はがき", e: "Postcard" },
{ k: "切手", h: "きって", e: "Postage stamp" },
{ k: "封筒", h: "ふうとう", e: "Envelope" },
{ k: "送る", h: "おくる", e: "To send" },
{ k: "受け取る", h: "うけとる", e: "To receive" },
{ k: "渡す", h: "わたす", e: "To hand over" },
{ k: "届く", h: "とどく", e: "To arrive / To reach" },
{ k: "宅配", h: "たくはい", e: "Home delivery" },
{ k: "住所", h: "じゅうしょ", e: "Address" },
{ k: "名前", h: "なまえ", e: "Name" },
{ k: "年齢", h: "ねんれい", e: "Age" },
{ k: "生年月日", h: "せいねんがっぴ", e: "Birth date" },
{ k: "性別", h: "せいべつ", e: "Gender" },
{ k: "男", h: "おとこ", e: "Male" },
{ k: "女", h: "おんな", e: "Female" },
{ k: "職業", h: "しょくぎょう", e: "Occupation" },
{ k: "会社員", h: "かいしゃいん", e: "Company employee" },
{ k: "店員", h: "てんいん", e: "Shop clerk" },
{ k: "警官", h: "けいかん", e: "Police officer" },
{ k: "消防士", h: "しょうぼうし", e: "Firefighter" },
{ k: "看護師", h: "かんごし", e: "Nurse" },
{ k: "弁護士", h: "べんごし", e: "Lawyer" },
{ k: "会計", h: "かいけい", e: "Accounting / Checkout" },
{ k: "レシート", h: "レシート", e: "Receipt" },
{ k: "領収書", h: "りょうしゅうしょ", e: "Receipt (formal)" },
{ k: "値段", h: "ねだん", e: "Price" },
{ k: "割引", h: "わりびき", e: "Discount" },
{ k: "無料", h: "むりょう", e: "Free of charge" },
{ k: "有料", h: "ゆうりょう", e: "Paid / Chargeable" },
{ k: "税金", h: "ぜいきん", e: "Tax" },
{ k: "消費税", h: "しょうひぜい", e: "Consumption tax" },
{ k: "現金", h: "げんきん", e: "Cash" },
{ k: "クレジットカード", h: "クレジットカード", e: "Credit card" },
{ k: "電子マネー", h: "でんしマネー", e: "Electronic money" },
{ k: "お釣り", h: "おつり", e: "Change (money)" },
{ k: "財布", h: "さいふ", e: "Wallet" },
{ k: "銀行", h: "ぎんこう", e: "Bank" },
{ k: "ATM", h: "エーティーエム", e: "ATM" },
{ k: "お金", h: "おかね", e: "Money" },
{ k: "両替", h: "りょうがえ", e: "Money exchange" },
{ k: "千円", h: "せんえん", e: "1000 yen" },
{ k: "万円", h: "まんえん", e: "10000 yen" },
{ k: "高い", h: "たかい", e: "Expensive" },
{ k: "安い", h: "やすい", e: "Cheap" },
{ k: "美味しい", h: "おいしい", e: "Delicious" },
{ k: "不味い", h: "まずい", e: "Not tasty" },
{ k: "温かい", h: "あたたかい", e: "Warm" },
{ k: "冷たい", h: "つめたい", e: "Cold" },
{ k: "熱い", h: "あつい", e: "Hot" },
{ k: "生", h: "なま", e: "Raw / Fresh" },
{ k: "冷凍", h: "れいとう", e: "Frozen" },
{ k: "賞味期限", h: "しょうみきげん", e: "Best before date" },
{ k: "消費期限", h: "しょうひきげん", e: "Expiration date" },
{ k: "開ける", h: "あける", e: "To open" },
{ k: "閉める", h: "しめる", e: "To close" },
{ k: "点ける", h: "つける", e: "To turn on" },
{ k: "消す", h: "けす", e: "To turn off / To erase" },
{ k: "入れる", h: "いれる", e: "To put in" },
{ k: "出す", h: "だす", e: "To take out" },
{ k: "捨てる", h: "すてる", e: "To throw away" },
{ k: "拾う", h: "ひろう", e: "To pick up" },
{ k: "洗う", h: "あらう", e: "To wash" },
{ k: "洗濯", h: "せんたく", e: "Laundry" },
{ k: "干す", h: "ほす", e: "To dry" },
{ k: "掃除", h: "そうじ", e: "Cleaning" },
{ k: "拭く", h: "ふく", e: "To wipe" },
{ k: "磨く", h: "みがく", e: "To brush / To polish" },
{ k: "歯磨き", h: "はみがき", e: "Tooth brushing" },
{ k: "風呂", h: "ふろ", e: "Bath" },
{ k: "シャワー", h: "シャワー", e: "Shower" },
{ k: "石鹸", h: "せっけん", e: "Soap" },
{ k: "シャンプー", h: "シャンプー", e: "Shampoo" },
{ k: "タオル", h: "タオル", e: "Towel" },
{ k: "歯ブラシ", h: "はブラシ", e: "Toothbrush" },
{ k: "洗剤", h: "せんざい", e: "Detergent" },
{ k: "ゴミ", h: "ゴミ", e: "Trash" },
{ k: "ゴミ箱", h: "ゴミばこ", e: "Trash can" },
{ k: "資源ゴミ", h: "しげんゴミ", e: "Recyclable trash" },
{ k: "燃えるゴミ", h: "もえるゴミ", e: "Burnable trash" },
{ k: "燃えないゴミ", h: "もえないゴミ", e: "Non-burnable trash" },
{ k: "粗大ゴミ", h: "そだいゴミ", e: "Bulky trash" },
{ k: "天気予報", h: "てんきよほう", e: "Weather forecast" },
{ k: "晴れ", h: "はれ", e: "Sunny" },
{ k: "曇り", h: "くもり", e: "Cloudy" },
{ k: "雨", h: "あめ", e: "Rain" },
{ k: "雪", h: "ゆき", e: "Snow" },
{ k: "嵐", h: "あらし", e: "Storm" },
{ k: "台風", h: "たいふう", e: "Typhoon" },
{ k: "地震", h: "じしん", e: "Earthquake" },
{ k: "雷", h: "かみなり", e: "Thunder / Lightning" },
{ k: "洪水", h: "こうずい", e: "Flood" },
{ k: "警報", h: "けいほう", e: "Warning (emergency)" },
{ k: "避難", h: "ひなん", e: "Evacuation" },
{ k: "火事", h: "かじ", e: "Fire" },
{ k: "救急車", h: "きゅうきゅうしゃ", e: "Ambulance" },
{ k: "警察", h: "けいさつ", e: "Police" },
{ k: "事故", h: "じこ", e: "Accident" },
{ k: "怪我", h: "けが", e: "Injury" },
{ k: "病気", h: "びょうき", e: "Sickness" },
{ k: "熱", h: "ねつ", e: "Fever" },
{ k: "咳", h: "せき", e: "Cough" },
{ k: "頭痛", h: "ずつう", e: "Headache" },
{ k: "腹痛", h: "ふくつう", e: "Stomach ache" },
{ k: "歯痛", h: "はいた", e: "Toothache" },
{ k: "風邪", h: "かぜ", e: "Cold (illness)" },
{ k: "インフルエンザ", h: "インフルエンザ", e: "Flu" },
{ k: "コロナ", h: "コロナ", e: "Coronavirus" },
{ k: "ワクチン", h: "ワクチン", e: "Vaccine" },
{ k: "病院", h: "びょういん", e: "Hospital" },
{ k: "診療所", h: "しんりょうじょ", e: "Clinic" },
{ k: "薬局", h: "やっきょく", e: "Pharmacy" },
{ k: "処方箋", h: "しょほうせん", e: "Prescription" },
{ k: "健康保険", h: "けんこうほけん", e: "Health insurance" },
{ k: "診察", h: "しんさつ", e: "Medical examination" },
{ k: "予約", h: "よやく", e: "Appointment" },
{ k: "キャンセル", h: "キャンセル", e: "Cancellation" },
{ k: "変更", h: "へんこう", e: "Change / Modification" },
{ k: "確認", h: "かくにん", e: "Confirmation" },
        ];

        // ----- STATE -----
        let deck = [], history = [], currentCard = null;
        let currentView = 'search'; // 'search', 'flashcard', 'quiz'
        
        // Quiz state
        let quizQuestions = [];
        let currentQuizIndex = 0;
        let userAnswers = [];
        let quizFinished = false;

        // ----- HOME: return to search view -----
        function goHome() {
            setActiveView('search');
        }

        // ----- VIEW MANAGEMENT -----
        function setActiveView(viewName) {
            document.getElementById('searchView').classList.remove('active-view');
            document.getElementById('flashcardView').classList.remove('active-view');
            document.getElementById('quizView').classList.remove('active-view');
            
            if (viewName === 'search') {
                document.getElementById('searchView').classList.add('active-view');
                currentView = 'search';
            } else if (viewName === 'flashcard') {
                document.getElementById('flashcardView').classList.add('active-view');
                currentView = 'flashcard';
                resetDeck();
                showNext();
            } else if (viewName === 'quiz') {
                document.getElementById('quizView').classList.add('active-view');
                currentView = 'quiz';
                // quiz already started via startQuiz()
            }
        }

        // Toggle flashcard on/off (if already in flashcard, go home; else go flashcard)
        function toggleFlashcard() {
            if (currentView === 'flashcard') {
                setActiveView('search');
            } else {
                setActiveView('flashcard');
            }
        }

        // ----- SEARCH -----
        function search() {
            const query = document.getElementById('searchBar').value.toLowerCase();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            const filtered = query ? kanjiData.filter(item => 
                item.k.includes(query) || item.e.toLowerCase().includes(query) || item.h.includes(query)
            ) : kanjiData;

            filtered.forEach(item => {
                const card = document.createElement('div');
                card.className = 'kanji-list-item';
                card.innerHTML = `<div style="font-size:32px; font-weight:bold;">${item.k}</div>
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <span style="color:var(--accent)">${item.h}</span>
                        <span style="color:var(--sub-text)">${item.e}</span>
                    </div>`;
                resultsDiv.appendChild(card);
            });
        }

        // ----- FLASHCARD -----
        function resetDeck() {
            deck = [...kanjiData].sort(() => Math.random() - 0.5);
            history = []; currentCard = null;
        }

        function displayCard(card) {
            currentCard = card;
            const kanjiEl = document.getElementById('fcKanji');
            const len = card.k.length;
            if (len > 5) kanjiEl.style.fontSize = 'clamp(40px, 12vw, 70px)';
            else if (len > 3) kanjiEl.style.fontSize = 'clamp(50px, 15vw, 100px)';
            else kanjiEl.style.fontSize = 'clamp(60px, 20vw, 140px)';
            kanjiEl.innerText = card.k;
            document.getElementById('fcHiragana').innerText = card.h;
            document.getElementById('fcEnglish').innerText = card.e;
        }

        function showNext() {
            if (deck.length === 0) resetDeck();
            if (currentCard) history.push(currentCard);
            displayCard(deck.pop());
        }

        function showPrev() {
            if (history.length > 0) {
                deck.push(currentCard);
                displayCard(history.pop());
            }
        }

        // Swipe for flashcard
        let startX = 0, currentX = 0;
        const fcView = document.getElementById('flashcardView');
        const container = document.getElementById('fcContainer');
        fcView.addEventListener('touchstart', (e) => {
            if (currentView !== 'flashcard') return;
            startX = e.touches[0].clientX;
            container.style.transition = 'none';
        });
        fcView.addEventListener('touchmove', (e) => {
            if (currentView !== 'flashcard') return;
            currentX = e.touches[0].clientX - startX;
            container.style.transform = `translateX(${currentX}px)`;
        });
        fcView.addEventListener('touchend', () => {
            if (currentView !== 'flashcard') return;
            container.style.transition = 'transform 0.2s ease-out';
            if (currentX < -80) { 
                container.style.transform = 'translateX(-100%)';
                setTimeout(() => {
                    showNext();
                    container.style.transition = 'none';
                    container.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        container.style.transition = 'transform 0.2s ease-out';
                        container.style.transform = 'translateX(0)';
                    }, 20);
                }, 200);
            } else if (currentX > 80) { 
                container.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    showPrev();
                    container.style.transition = 'none';
                    container.style.transform = 'translateX(-100%)';
                    setTimeout(() => {
                        container.style.transition = 'transform 0.2s ease-out';
                        container.style.transform = 'translateX(0)';
                    }, 20);
                }, 200);
            } else {
                container.style.transform = 'translateX(0)';
            }
            currentX = 0;
        });

        // ----- QUIZ (Kanji first) -----
        function startQuiz() {
            const shuffled = [...kanjiData].sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, 20);
            
            quizQuestions = selected.map(correctCard => {
                let distractor;
                do { distractor = kanjiData[Math.floor(Math.random() * kanjiData.length)]; } 
                while (distractor.k === correctCard.k);
                
                const optionCorrect = { hiragana: correctCard.h, english: correctCard.e };
                const optionWrong = { hiragana: distractor.h, english: distractor.e };
                
                const options = [optionCorrect, optionWrong];
                if (Math.random() < 0.5) options.reverse();
                
                return {
                    kanji: correctCard.k,
                    correctHiragana: correctCard.h,
                    options: options
                };
            });

            currentQuizIndex = 0;
            userAnswers = new Array(20).fill(null);
            quizFinished = false;
            renderQuiz();
            setActiveView('quiz');
        }

        function renderQuiz() {
            const container = document.getElementById('quizContainer');
            const resultArea = document.getElementById('quizResultArea');
            const progress = document.getElementById('quizProgress');
            const scoreDisplay = document.getElementById('quizScoreDisplay');
            
            if (quizFinished) {
                container.style.display = 'none';
                resultArea.style.display = 'block';
                let html = `
                    <table class="result-table">
                        <thead><tr><th>Kanji</th><th>Your answer</th><th>Correct</th></tr></thead>
                        <tbody>
                `;
                quizQuestions.forEach((q, idx) => {
                    const ansIdx = userAnswers[idx];
                    const selectedOption = ansIdx !== null ? q.options[ansIdx] : null;
                    const selectedHiragana = selectedOption ? selectedOption.hiragana : '—';
                    const isCorrect = (selectedOption && selectedOption.hiragana === q.correctHiragana);
                    const rowClass = isCorrect ? 'correct-row' : 'wrong-row';
                    html += `<tr class="${rowClass}">
                        <td><strong>${q.kanji}</strong></td>
                        <td>${selectedHiragana}</td>
                        <td>${q.correctHiragana}</td>
                    </tr>`;
                });
                html += '</tbody></table><button class="restart-quiz" onclick="startQuiz()">Restart quiz</button>';
                resultArea.innerHTML = html;
                return;
            }

            container.style.display = 'block';
            resultArea.style.display = 'none';
            
            const q = quizQuestions[currentQuizIndex];
            const selectedIndex = userAnswers[currentQuizIndex];
            
            let optionsHtml = '';
            q.options.forEach((opt, idx) => {
                let extraClass = '';
                if (selectedIndex !== null) {
                    const isCorrectOption = (opt.hiragana === q.correctHiragana);
                    extraClass = isCorrectOption ? 'correct-disabled' : 'wrong-disabled';
                }
                if (selectedIndex === idx) extraClass += ' selected';
                
                optionsHtml += `
                    <div class="quiz-option ${extraClass}" onclick="selectOption(${idx})">
                        <span class="option-hiragana">${opt.hiragana}</span>
                        <span class="option-english">${opt.english}</span>
                    </div>
                `;
            });

            container.innerHTML = `
                <div class="quiz-card">
                    <div class="quiz-question-kanji">${q.kanji}</div>
                    <div class="quiz-options">${optionsHtml}</div>
                    <div class="quiz-footer">
                        <button class="quiz-btn" ${currentQuizIndex === 0 ? 'disabled' : ''} onclick="prevQuiz()">Prev</button>
                        <button class="quiz-btn" onclick="nextQuiz()">${currentQuizIndex === 19 ? 'Finish' : 'Next'}</button>
                    </div>
                </div>
            `;
            
            progress.innerText = `Q${currentQuizIndex+1}/20`;
            const answeredCount = userAnswers.filter(a => a !== null).length;
            scoreDisplay.innerText = `${answeredCount} / 20`;
        }

        function selectOption(optIdx) {
            if (quizFinished) return;
            if (userAnswers[currentQuizIndex] !== null) return;
            userAnswers[currentQuizIndex] = optIdx;
            renderQuiz();
        }

        function prevQuiz() { if (currentQuizIndex > 0) { currentQuizIndex--; renderQuiz(); } }
        function nextQuiz() { if (currentQuizIndex < 19) { currentQuizIndex++; renderQuiz(); } else { quizFinished = true; renderQuiz(); } }

        // ----- THEME toggle + icon swap -----
        function toggleTheme() {
            const body = document.body;
            const themeBtnIcon = document.querySelector('#themeNavBtn i');
            const currentTheme = body.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                body.setAttribute('data-theme', 'light');
                themeBtnIcon.className = 'fas fa-circle-half-stroke';
            } else {
                body.setAttribute('data-theme', 'dark');
                themeBtnIcon.className = 'fas fa-sun';
            }
        }

        // init search
        search();
    </script>
</body>
</html>

